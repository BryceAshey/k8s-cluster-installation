#cloud-config

hostname: k8s-worker
manage_etc_hosts: true

locale: 'en_AU.UTF-8'
timezone: 'Australia/Melbourne'

apt_preserve_sources_list: true
apt_update: true
apt_upgrade: true

users:
  - name: pi
    primary-group: users
    shell: /bin/bash
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: users
    ssh_import_id: None
    ## To enable SSH password log in
    ## mkpasswd --method=SHA-512 --rounds=4096
    # passwd: ""
    # lock_passwd: false
    # ssh_pwauth: true
    lock_passwd: true
    ssh_pwauth: false
    ssh_authorized_keys:
      - 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDFgxTVSx99UCkFdOHnGI6R7W7UMBwsjH8uBRMfx38DKGbCOnATW6jqAvxHkB32MQLE70lGOymsgkgahnuT2NmrIRBiHWPp8vGkQzUFWx54VyLN0zo+PMpy590iUW+0uHzcFfbywvHv1DCPnA+34oXA45iiOj1K5QbzEMNGOJuuaJsFszOr0WvnlNfvYw8lA5Be2AddkC2WMz4ZwpF9Z8r7O8fBwENxETlGej/VMb4Q2RMDrg05096QsszJijYNysmVRxqcACuxbphvR53eW8dvzO69Ga4qXxHGxINzgxX4sy7hxEl4A4DXEZhvgEiVMughQjrr3sfS6JufWE+V4tsL siyuanhu@SIYUANs-MBP'

write_files:
  - path: /etc/netplan/50-cloud-init.yaml
    permissions: '0644'
    content: |
      network:
        version: 2
        ethernets:
          eth0:
            addresses:
              - 192.168.8.150/24
            gateway4: 192.168.8.1
            nameservers:
              addresses:
                - 1.1.1.1
                - 8.8.8.8

runcmd:
  - [sudo, netplan, apply]
  - [
      sudo,
      sed,
      -i,
      's/PasswordAuthentication no/PasswordAuthentication yes/g',
      /etc/ssh/sshd_config,
    ]
  - [sudo, systemctl, restart, sshd]
